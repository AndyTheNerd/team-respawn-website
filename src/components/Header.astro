---
import SocialIcons from './SocialIcons.astro';
import SearchBar from './SearchBar.astro';

const { showPanelButton = true } = Astro.props;
const pathname = Astro.url?.pathname ?? '';
const isHome = pathname === '/' || pathname === '/index.html';
const isBlog = pathname.startsWith('/blog');
const isGuides = isBlog && Astro.url?.searchParams?.get('category')?.toLowerCase() === 'guides';
const isStorehaus = pathname.startsWith('/storehaus');
const isHw2Stats = pathname.startsWith('/halo-wars-stats');
---

<header class="compact-header relative w-full mb-6">
  <div class="header-glass-container compact-header-glass relative w-full px-4 lg:px-6 py-3 rounded-xl overflow-visible">
    <div class="header-content-wrapper relative z-10 flex items-center justify-between gap-4">
      <!-- Left Section: Logo + Hamburger -->
      <div class="flex items-center gap-3 flex-shrink-0">
        <a href="/" aria-label="Return to Team Respawn homepage" class="logo-link inline-block group">
          <img
            src="/content/Team-Respawn-Full.png"
            alt="Team Respawn Logo"
            width="150"
            height="40"
            class="header-logo-compact h-8 sm:h-10 w-auto cursor-pointer transition-all duration-300 group-hover:scale-105 group-hover:drop-shadow-[0_0_12px_rgba(168,85,247,0.6)]"
            loading="eager"
          />
        </a>

        {showPanelButton && (
          <button
            id="open-panel-button"
            data-open-panel
            class="header-menu-btn-compact flex-shrink-0 p-2 rounded-lg backdrop-blur-sm bg-gray-800/40 hover:bg-gray-700/60 border border-white/10 hover:border-purple-400/30 transition-all duration-300 hover:scale-110 group"
            aria-label="Open navigation menu"
            aria-expanded="false"
            aria-controls="side-panel"
            type="button"
          >
            <svg class="h-5 w-5 text-gray-300 group-hover:text-purple-300 transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
          </button>
        )}
      </div>

      <!-- Center Section: Main Navigation (hidden on mobile) -->
      <nav class="hidden lg:flex items-center gap-1 flex-1 justify-center" role="tablist" aria-label="Main navigation">
        <button
          id="home-tab"
          data-tab-link="/"
          role="tab"
          aria-selected={isHome ? "true" : "false"}
          aria-controls="home-content"
          aria-label="View home"
          class={`nav-link ${isHome ? 'nav-link-active' : ''}`}
          type="button"
          tabindex={isHome ? "0" : "-1"}
        >
          Home
        </button>
        <button
          id="walkthroughs-tab"
          data-tab-link="/#walkthroughs"
          role="tab"
          aria-selected="false"
          aria-controls="walkthroughs-content"
          aria-label="View walkthroughs"
          class="nav-link"
          type="button"
          tabindex="-1"
        >
          Walkthroughs
        </button>
        <div class="nav-dropdown" data-dropdown>
          <button
            id="guides-dropdown-toggle"
            class={`nav-link nav-dropdown-toggle ${isGuides ? 'nav-link-active' : ''}`}
            type="button"
            aria-expanded="false"
            aria-controls="guides-dropdown-menu"
            aria-label="Open guides menu"
            data-dropdown-toggle
          >
            Guides
            <svg class="nav-dropdown-icon h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div id="guides-dropdown-menu" class="nav-dropdown-menu" role="menu" aria-label="Guides pages" data-dropdown-menu>
            <a href="/blog?category=Guides&tag=Halo%20Wars%201" class="nav-dropdown-item" role="menuitem">
              Halo Wars 1
            </a>
            <a href="/blog?category=Guides&tag=Halo%20Wars%202" class="nav-dropdown-item" role="menuitem">
              Halo Wars 2
            </a>
            <a href="/blog?category=Guides&tag=Age%20of%20Empires%20II" class="nav-dropdown-item" role="menuitem">
              Age of Empires II
            </a>
            <a href="/blog?category=Guides&tag=Age%20of%20Empires%20IV" class="nav-dropdown-item" role="menuitem">
              Age of Empires IV
            </a>
            <a href="/blog?category=Guides&tag=Age%20of%20Mythology" class="nav-dropdown-item" role="menuitem">
              Age of Mythology
            </a>
          </div>
        </div>
        <a
          href="/blog"
          class={`nav-link ${isBlog ? 'nav-link-active' : ''}`}
        >
          Blog
        </a>
        <a
          href="/halo-wars-stats"
          class={`nav-link ${isHw2Stats ? 'nav-link-active' : ''}`}
        >
          HW2 Stats
        </a>
        <button
          id="other-projects-tab"
          data-tab-link="/#other-projects"
          role="tab"
          aria-selected="false"
          aria-controls="other-projects-content"
          aria-label="View other projects"
          class="nav-link"
          type="button"
          tabindex="-1"
        >
          Projects
        </button>
        <div class="nav-dropdown" data-dropdown>
          <button
            class={`nav-link nav-dropdown-toggle ${isStorehaus ? 'nav-link-active' : ''}`}
            type="button"
            aria-expanded="false"
            aria-controls="storehaus-dropdown-menu"
            data-dropdown-toggle
          >
            Storehaus
            <svg class="nav-dropdown-icon h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div id="storehaus-dropdown-menu" class="nav-dropdown-menu" role="menu" aria-label="Storehaus pages" data-dropdown-menu>
            <a href="/storehaus-info" class="nav-dropdown-item" role="menuitem">Summary</a>
            <a href="/storehaus/privacy-policy" class="nav-dropdown-item" role="menuitem">Privacy Policy</a>
            <a href="/storehaus/terms-of-service" class="nav-dropdown-item" role="menuitem">Terms of Service</a>
            <a href="/storehaus" class="nav-dropdown-item" role="menuitem" target="_blank" rel="noopener noreferrer">Add to Server</a>
          </div>
        </div>
      </nav>

      <!-- Right Section: Search + Social Icons -->
      <div class="flex items-center gap-3 flex-shrink-0">
        <SearchBar />
        <div class="header-social-container-compact hidden sm:block" aria-label="Social media links">
          <SocialIcons compact />
        </div>
      </div>
    </div>
  </div>

  <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="tab-announcement"></div>
</header>
